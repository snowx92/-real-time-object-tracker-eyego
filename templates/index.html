<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Object Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            text-align: center;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .model-selector {
            margin-bottom: 30px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.2em;
            font-weight: bold;
            color: #555;
        }
        
        select {
            padding: 15px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: white;
            min-width: 300px;
            cursor: pointer;
        }
        
        select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 10px rgba(0,123,255,0.3);
        }
        
        .video-container {
            position: relative;
            display: inline-block;
            margin: 20px 0;
            border: 3px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
        }
        
        #videoFeed {
            display: block;
            max-width: 100%;
            height: auto;
            cursor: crosshair;
        }
        
        #selectionOverlay {
            position: absolute;
            border: 3px dashed #ff0000;
            background-color: rgba(255, 0, 0, 0.2);
            pointer-events: none;
            display: none;
            z-index: 10;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            font-size: 1.1em;
        }
        
        .status-active {
            color: #28a745;
            font-weight: bold;
        }
        
        .status-inactive {
            color: #dc3545;
        }
        
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .message-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            color: #007bff;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¯ Object Tracker</h1>
        
        <div class="model-selector">
            <label for="trackerSelect">Choose Tracking Model:</label>
            <select id="trackerSelect">
                <option value="">Select a tracker...</option>
            </select>
        </div>
        
        <div class="status">
            Status: <span id="statusText" class="status-inactive">No tracker selected</span>
        </div>
        
        <div class="video-container">
            <img id="videoFeed" src="/video_feed" alt="Video Feed">
            <div id="selectionOverlay"></div>
        </div>
        
        <div id="messageArea"></div>
    </div>

    <script>
        let isSelecting = false;
        let startX, startY;
        let videoRect;
        
        // DOM elements
        const trackerSelect = document.getElementById('trackerSelect');
        const videoFeed = document.getElementById('videoFeed');
        const selectionOverlay = document.getElementById('selectionOverlay');
        const statusText = document.getElementById('statusText');
        const messageArea = document.getElementById('messageArea');
        
        // Load available trackers on page load
        loadAvailableTrackers();
        
        // Tracker selection change
        trackerSelect.addEventListener('change', async () => {
            const selectedTracker = trackerSelect.value;
            if (!selectedTracker) return;
            
            showMessage('Initializing tracker...', 'loading');
            statusText.textContent = 'Initializing...';
            statusText.className = 'loading';
            
            try {
                const response = await fetch('/api/initialize', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({tracker_type: selectedTracker})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(`${data.tracker_type} tracker ready! Draw a box on the video to track an object.`, 'success');
                    statusText.textContent = `${data.tracker_type} - Ready`;
                    statusText.className = 'status-active';
                } else {
                    showMessage(`Error: ${data.message}`, 'error');
                    statusText.textContent = 'Error';
                    statusText.className = 'status-inactive';
                    trackerSelect.value = '';
                }
            } catch (error) {
                showMessage(`Network error: ${error.message}`, 'error');
                statusText.textContent = 'Error';
                statusText.className = 'status-inactive';
                trackerSelect.value = '';
            }
        });
        
        // Video mouse events for bounding box selection
        videoFeed.addEventListener('mousedown', (e) => {
            if (trackerSelect.value === '') {
                showMessage('Please select a tracker first!', 'error');
                return;
            }
            
            isSelecting = true;
            videoRect = videoFeed.getBoundingClientRect();
            
            startX = e.clientX - videoRect.left;
            startY = e.clientY - videoRect.top;
            
            // Initialize overlay
            selectionOverlay.style.display = 'block';
            selectionOverlay.style.left = startX + 'px';
            selectionOverlay.style.top = startY + 'px';
            selectionOverlay.style.width = '0px';
            selectionOverlay.style.height = '0px';
            
            e.preventDefault();
        });
        
        videoFeed.addEventListener('mousemove', (e) => {
            if (!isSelecting) return;
            
            const currentX = e.clientX - videoRect.left;
            const currentY = e.clientY - videoRect.top;
            
            const left = Math.min(startX, currentX);
            const top = Math.min(startY, currentY);
            const width = Math.abs(currentX - startX);
            const height = Math.abs(currentY - startY);
            
            selectionOverlay.style.left = left + 'px';
            selectionOverlay.style.top = top + 'px';
            selectionOverlay.style.width = width + 'px';
            selectionOverlay.style.height = height + 'px';
        });
        
        videoFeed.addEventListener('mouseup', async (e) => {
            if (!isSelecting) return;
            
            isSelecting = false;
            const endX = e.clientX - videoRect.left;
            const endY = e.clientY - videoRect.top;
            
            const left = Math.min(startX, endX);
            const top = Math.min(startY, endY);
            const width = Math.abs(endX - startX);
            const height = Math.abs(endY - startY);
            
            // Hide overlay
            selectionOverlay.style.display = 'none';
            
            // Check if selection is large enough
            if (width < 20 || height < 20) {
                showMessage('Selection too small. Please draw a larger bounding box.', 'error');
                return;
            }
            
            // Convert to video coordinates
            const scaleX = videoFeed.naturalWidth / videoFeed.clientWidth;
            const scaleY = videoFeed.naturalHeight / videoFeed.clientHeight;
            
            const bbox = [
                Math.round(left * scaleX),
                Math.round(top * scaleY),
                Math.round(width * scaleX),
                Math.round(height * scaleY)
            ];
            
            // Send bounding box to server
            try {
                showMessage('Starting tracking...', 'loading');
                
                const response = await fetch('/api/set_bbox', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({bbox: bbox})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('Tracking started! The object will be tracked automatically.', 'success');
                    statusText.textContent = `${trackerSelect.options[trackerSelect.selectedIndex].text} - Tracking`;
                    statusText.className = 'status-active';
                } else {
                    showMessage(`Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showMessage(`Error: ${error.message}`, 'error');
            }
        });
        
        // Load available trackers
        async function loadAvailableTrackers() {
            try {
                const response = await fetch('/api/available_trackers');
                const data = await response.json();
                
                // Clear existing options
                trackerSelect.innerHTML = '<option value="">Select a tracker...</option>';
                
                // Add tracker options
                data.trackers.forEach(tracker => {
                    const option = document.createElement('option');
                    option.value = tracker.type;
                    option.textContent = `${tracker.name} - ${tracker.description}`;
                    trackerSelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Failed to load trackers:', error);
                showMessage('Failed to load available trackers', 'error');
            }
        }
        
        // Show message function
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            messageDiv.textContent = message;
            
            messageArea.innerHTML = '';
            messageArea.appendChild(messageDiv);
            
            // Auto-remove message after 5 seconds (except loading messages)
            if (type !== 'loading') {
                setTimeout(() => {
                    messageDiv.remove();
                }, 5000);
            }
        }
        
        // Update status periodically
        setInterval(async () => {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                if (data.tracking && statusText.textContent.includes('Ready')) {
                    statusText.textContent = statusText.textContent.replace('Ready', 'Tracking');
                }
            } catch (error) {
                // Ignore status update errors
            }
        }, 2000);
    </script>
</body>
</html> 